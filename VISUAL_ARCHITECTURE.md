# ğŸ¨ Visual Implementation Guide

## System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER INTERFACE                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Donations.tsx      â”‚           â”‚  Membership.tsx      â”‚   â”‚
â”‚  â”‚                      â”‚           â”‚                      â”‚   â”‚
â”‚  â”‚ âœ“ Form Fields       â”‚           â”‚ âœ“ Form Wizard       â”‚   â”‚
â”‚  â”‚ âœ“ Amount Input      â”‚           â”‚ âœ“ 4 Steps           â”‚   â”‚
â”‚  â”‚ âœ“ Submit Button     â”‚           â”‚ âœ“ Payment Modal     â”‚   â”‚
â”‚  â”‚ âœ“ Error Display     â”‚           â”‚ âœ“ Success Screen    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                                â”‚
                  â”‚ createDonationOrder()          â”‚ createMembershipOrder()
                  â”‚ verifyDonationPayment()        â”‚ verifyMembershipPayment()
                  â”‚                                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FRONTEND API  â”‚                                â”‚              â”‚
â”‚  (api.ts)       â”‚                                â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚                                â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                          â”‚                                   â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”
â”‚  CREATE ORDER        â”‚ â”‚ VERIFY PAYMENT     â”‚ â”‚  RAZORPAY MODAL    â”‚
â”‚                      â”‚ â”‚                    â”‚ â”‚                    â”‚
â”‚ POST /create-order   â”‚ â”‚ POST /verify-pay   â”‚ â”‚ Payment Methods:   â”‚
â”‚                      â”‚ â”‚                    â”‚ â”‚ âœ“ UPI (PRIMARY)   â”‚
â”‚ Returns:            â”‚ â”‚ Verifies:          â”‚ â”‚ âœ“ Cards            â”‚
â”‚ - orderId          â”‚ â”‚ - HMAC SHA256      â”‚ â”‚ âœ“ Netbanking       â”‚
â”‚ - keyId            â”‚ â”‚ - Payment Details  â”‚ â”‚ âœ“ Wallets          â”‚
â”‚ - amount           â”‚ â”‚ - Updates DB       â”‚ â”‚                    â”‚
â”‚ - donationDbId     â”‚ â”‚                    â”‚ â”‚ Returns:           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ - order_id         â”‚
                                              â”‚ - payment_id       â”‚
                                              â”‚ - signature        â”‚
                                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Payment Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User Action  â”‚
â”‚ (Submit Form)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend Validation            â”‚
â”‚ - Form fields check            â”‚
â”‚ - Amount validation            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: Create Order              â”‚
â”‚ - Save record with status:pending  â”‚
â”‚ - Create Razorpay Order ID         â”‚
â”‚ - Return orderId + keyId           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Load Razorpay Script               â”‚
â”‚ https://checkout.razorpay.com/...  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Open Razorpay Modal                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚   UPI âœ“  â”‚  Cards   â”‚ Bank    â”‚Wallet  â”‚ â”‚
â”‚ â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”¤ â”‚
â”‚ â”‚          â”‚          â”‚         â”‚        â”‚ â”‚
â”‚ â”‚ VPA ID   â”‚ Number   â”‚ Account â”‚Balance â”‚ â”‚
â”‚ â”‚ OTP flow â”‚ CVV Date â”‚ PIN     â”‚ Login  â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ User Completes Payment             â”‚
â”‚ - Selects Payment Method           â”‚
â”‚ - Enters Details (UPI ID, etc.)    â”‚
â”‚ - Authenticates (OTP, PIN, etc.)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Razorpay Processes Payment                 â”‚
â”‚ - Communicates with Bank/Provider          â”‚
â”‚ - Generates Payment ID                     â”‚
â”‚ - Creates Signature                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontend Payment Callback Handler          â”‚
â”‚ - Receives: order_id, payment_id, sig      â”‚
â”‚ - Calls: verifyPayment() to backend        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend: Verify Payment                    â”‚
â”‚ - Generate expected signature              â”‚
â”‚ - Verify: HMAC SHA256                      â”‚
â”‚   crypto.createHmac('sha256', SECRET)      â”‚
â”‚   .update(`${orderId}|${paymentId}`)       â”‚
â”‚   .digest('hex')                           â”‚
â”‚ - Compare with received signature          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    â”‚          â”‚
    â–¼          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ“ VALID   â”‚ â”‚ âœ— INVALID        â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                  â”‚
      â–¼                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Update DB:   â”‚ â”‚ Return Error    â”‚
â”‚ - Payment    â”‚ â”‚ - Reject        â”‚
â”‚   Status:    â”‚ â”‚ - No DB update  â”‚
â”‚   completed  â”‚ â”‚ - Show to user  â”‚
â”‚ - Store UPI  â”‚ â”‚                 â”‚
â”‚   ID         â”‚ â”‚ User must       â”‚
â”‚ - Store      â”‚ â”‚ retry or use    â”‚
â”‚   payment    â”‚ â”‚ different card  â”‚
â”‚   method     â”‚ â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Generate Receipt         â”‚
â”‚ - PDF file created       â”‚
â”‚ - Saved to server        â”‚
â”‚ - Includes:              â”‚
â”‚   â€¢ Amount               â”‚
â”‚   â€¢ Date & Time          â”‚
â”‚   â€¢ Payment Method (UPI) â”‚
â”‚   â€¢ UPI ID               â”‚
â”‚   â€¢ Receipt Number       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Send Receipt Email       â”‚
â”‚ - To: user email         â”‚
â”‚ - From: CREA             â”‚
â”‚ - Subject: Receipt       â”‚
â”‚ - Attachment: PDF        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Show Success to User     â”‚
â”‚ - Green checkmark        â”‚
â”‚ - "Payment Successful"   â”‚
â”‚ - Receipt Sent message   â”‚
â”‚ - Auto-redirect (5 sec)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Membership Auto-Activation:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ For Membership Payment:   â”‚
â”‚ Set status = "active"    â”‚
â”‚ Set validity dates       â”‚
â”‚ Auto-send welcome email  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database Record Structure

### Donation Record (After Payment)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Donation Collection                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _id: ObjectId                           â”‚
â”‚                                          â”‚
â”‚ DONOR INFO:                             â”‚
â”‚ â”œâ”€ fullName: "John Doe"                 â”‚
â”‚ â”œâ”€ email: "john@email.com"              â”‚
â”‚ â”œâ”€ mobile: "9876543210"                 â”‚
â”‚ â””â”€ address: {city, state, pincode}      â”‚
â”‚                                          â”‚
â”‚ DONATION DETAILS:                       â”‚
â”‚ â”œâ”€ amount: 1000                         â”‚
â”‚ â”œâ”€ purpose: "education"                 â”‚
â”‚ â””â”€ message: "Good luck"                 â”‚
â”‚                                          â”‚
â”‚ PAYMENT DETAILS: âœ¨ NEW                 â”‚
â”‚ â”œâ”€ paymentMethod: "upi" âœ“              â”‚
â”‚ â”œâ”€ upiId: "9876543210@okaxis" âœ“        â”‚
â”‚ â”œâ”€ paymentStatus: "completed"           â”‚
â”‚ â”œâ”€ paymentDate: 2025-12-17...          â”‚
â”‚ â”œâ”€ paymentReference: "pay_xxxxx"        â”‚
â”‚                                          â”‚
â”‚ RAZORPAY INFO:                          â”‚
â”‚ â”œâ”€ razorpayOrderId: "order_xxxxx"       â”‚
â”‚ â”œâ”€ razorpayPaymentId: "pay_xxxxx"       â”‚
â”‚ â””â”€ razorpaySignature: "hash_verified"   â”‚
â”‚                                          â”‚
â”‚ METADATA:                               â”‚
â”‚ â”œâ”€ createdAt: 2025-12-17...            â”‚
â”‚ â””â”€ updatedAt: 2025-12-17...            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Membership Record (After Payment)
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Membership Collection                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ _id: ObjectId                           â”‚
â”‚ membershipId: "CREA202500001"          â”‚
â”‚                                          â”‚
â”‚ MEMBER INFO:                            â”‚
â”‚ â”œâ”€ name: "Jane Smith"                   â”‚
â”‚ â”œâ”€ email: "jane@email.com"              â”‚
â”‚ â”œâ”€ mobile: "9876543210"                 â”‚
â”‚ â””â”€ designation: "Manager"               â”‚
â”‚                                          â”‚
â”‚ MEMBERSHIP DETAILS:                     â”‚
â”‚ â”œâ”€ type: "ordinary"                     â”‚
â”‚ â”œâ”€ status: "active" âœ“ AUTO-ACTIVATED   â”‚
â”‚ â”œâ”€ validFrom: 2025-12-17               â”‚
â”‚ â””â”€ validUntil: 2026-12-17              â”‚
â”‚                                          â”‚
â”‚ PAYMENT DETAILS: âœ¨ NEW                 â”‚
â”‚ â”œâ”€ paymentMethod: "upi" âœ“              â”‚
â”‚ â”œâ”€ upiId: "jane@paytm" âœ“               â”‚
â”‚ â”œâ”€ paymentAmount: 500                   â”‚
â”‚ â”œâ”€ paymentStatus: "completed"           â”‚
â”‚ â”œâ”€ paymentDate: 2025-12-17...          â”‚
â”‚ â”œâ”€ paymentReference: "pay_xxxxx"        â”‚
â”‚                                          â”‚
â”‚ RAZORPAY INFO:                          â”‚
â”‚ â”œâ”€ razorpayOrderId: "order_xxxxx"       â”‚
â”‚ â”œâ”€ razorpayPaymentId: "pay_xxxxx"       â”‚
â”‚ â””â”€ razorpaySignature: "hash_verified"   â”‚
â”‚                                          â”‚
â”‚ METADATA:                               â”‚
â”‚ â”œâ”€ createdAt: 2025-12-17...            â”‚
â”‚ â””â”€ updatedAt: 2025-12-17...            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## UPI Payment Method Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User Selects UPI in Razorpay Modal        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Enter UPI ID       â”‚
        â”‚ e.g., user@provider
        â”‚                    â”‚
        â”‚ Examples:          â”‚
        â”‚ - 9876543210@okaxis
        â”‚ - user@paytm      â”‚
        â”‚ - user@ybl (PhonePe)
        â”‚ - user@upi        â”‚
        â”‚ - user@okhdfcbank â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Razorpay Generates OTP     â”‚
        â”‚ to Payment Provider        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ User's UPI App Shows       â”‚
        â”‚ Payment Request:           â”‚
        â”‚ From: CREA                 â”‚
        â”‚ Amount: â‚¹[amount]         â”‚
        â”‚ [Approve] [Reject]        â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ User Approves              â”‚
        â”‚ (Tap/Biometric)            â”‚
        â”‚                            â”‚
        â”‚ Enters OTP (if required)   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Payment Processor          â”‚
        â”‚ Processes Transaction      â”‚
        â”‚ Through NPCI Network       â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Razorpay Confirms:         â”‚
        â”‚ - Payment ID               â”‚
        â”‚ - VPA Used                 â”‚
        â”‚ - Amount Received          â”‚
        â”‚ - Signature Generated      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ Payment Sent to Frontend   â”‚
        â”‚ + Signature Verification   â”‚
        â”‚ on Backend âœ“               â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ âœ… Success!                â”‚
        â”‚ UPI ID Stored in DB        â”‚
        â”‚ Receipt Generated          â”‚
        â”‚ Email Sent                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security Verification Process

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HMAC SHA256 Signature Verification               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Receive from Frontend:                     â”‚
â”‚ {                                          â”‚
â”‚   razorpay_order_id: "order_xxxxx",       â”‚
â”‚   razorpay_payment_id: "pay_xxxxx",       â”‚
â”‚   razorpay_signature: "abc123def456"      â”‚
â”‚ }                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Backend Calculation:                       â”‚
â”‚ body = "order_xxxxx|pay_xxxxx"            â”‚
â”‚                                            â”‚
â”‚ expected = HMAC-SHA256(                   â”‚
â”‚   key: RAZORPAY_KEY_SECRET,               â”‚
â”‚   data: body                              â”‚
â”‚ )                                          â”‚
â”‚ = "xyz789abc012"                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Compare Signatures:                        â”‚
â”‚                                            â”‚
â”‚ Received: "abc123def456"                  â”‚
â”‚ Expected: "xyz789abc012"                  â”‚
â”‚                                            â”‚
â”‚ Match? â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
â”‚             â”‚              â”‚              â”‚
â”‚          âœ“ YES          âœ— NO              â”‚
â”‚             â”‚              â”‚              â”‚
â”‚             â–¼              â–¼              â”‚
â”‚       Update DB      Reject Payment       â”‚
â”‚       Mark as        Return Error         â”‚
â”‚       completed      Don't update DB      â”‚
â”‚                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Hierarchy

```
App
â”œâ”€â”€ Routes
â”‚   â”œâ”€â”€ /donations â†’ Donations.tsx
â”‚   â”‚   â”œâ”€â”€ Form Component
â”‚   â”‚   â”œâ”€â”€ Razorpay Modal
â”‚   â”‚   â”‚   â”œâ”€â”€ UPI Method âœ“
â”‚   â”‚   â”‚   â”œâ”€â”€ Card Method
â”‚   â”‚   â”‚   â”œâ”€â”€ Netbanking
â”‚   â”‚   â”‚   â””â”€â”€ Wallet
â”‚   â”‚   â”œâ”€â”€ Success Screen
â”‚   â”‚   â””â”€â”€ Error Display
â”‚   â”‚
â”‚   â””â”€â”€ /membership â†’ Membership.tsx
â”‚       â”œâ”€â”€ Plan Selection
â”‚       â”œâ”€â”€ Form Wizard (Steps 1-4)
â”‚       â”œâ”€â”€ Razorpay Modal
â”‚       â”‚   â”œâ”€â”€ UPI Method âœ“
â”‚       â”‚   â”œâ”€â”€ Card Method
â”‚       â”‚   â”œâ”€â”€ Netbanking
â”‚       â”‚   â””â”€â”€ Wallet
â”‚       â”œâ”€â”€ Success Screen
â”‚       â””â”€â”€ Error Display
â”‚
â”œâ”€â”€ API Service (api.ts)
â”‚   â”œâ”€â”€ createDonationOrder()
â”‚   â”œâ”€â”€ verifyDonationPayment()
â”‚   â”œâ”€â”€ createMembershipOrder()
â”‚   â””â”€â”€ verifyMembershipPayment()
â”‚
â””â”€â”€ Backend
    â”œâ”€â”€ Routes
    â”‚   â”œâ”€â”€ /api/donations/create-order
    â”‚   â”œâ”€â”€ /api/donations/verify-payment
    â”‚   â”œâ”€â”€ /api/memberships/create-order
    â”‚   â””â”€â”€ /api/memberships/verify-payment
    â”‚
    â”œâ”€â”€ Controllers
    â”‚   â”œâ”€â”€ donationController.js
    â”‚   â””â”€â”€ membershipController.js
    â”‚
    â””â”€â”€ Models
        â”œâ”€â”€ donationModel.js
        â””â”€â”€ membershipModel.js
```

---

## Status Workflow

```
DONATION PAYMENT LIFECYCLE:
pending â†’ (user completes payment) â†’ completed âœ“
       â†’ (signature invalid) â†’ rejected âœ—

MEMBERSHIP PAYMENT LIFECYCLE:
pending â†’ (user completes payment) â†’ active âœ“
       â†’ (signature invalid) â†’ rejected âœ—
       â†’ active â†’ (1 year later) â†’ expired
```

---

All systems operational! âœ…
